receivers:
    otlp:
        protocols:
            grpc:
                endpoint: 0.0.0.0:4317
            http:
                endpoint: 0.0.0.0:4318

exporters:
    # Logs → Loki по OTLP/HTTP
    otlphttp/loki:
        endpoint: http://loki:3100/otlp
        tls:
            insecure: true

    # Traces → Tempo по OTLP/gRPC
    otlp:
        endpoint: tempo:4317
        tls:
            insecure: true
        compression: gzip
        sending_queue:
            enabled: true
            num_consumers: 4
            queue_size: 1024
        retry_on_failure:
            enabled: true

    # Metrics → /metrics endpoint, который будет скрейпить Prometheus
    prometheus:
        endpoint: "0.0.0.0:8889"
        namespace: "otel"

processors:
    batch: {}

extensions:
    health_check:
        path: /health
    pprof: {}
    zpages: {}

service:
    extensions: [health_check, pprof, zpages]
    pipelines:
        traces:
            receivers: [otlp]
            processors: [batch]
            exporters: [otlp]
        metrics:
            receivers: [otlp]
            processors: [batch]
            exporters: [prometheus]

